# 이커머스 플랫폼 요구사항 정의서_V01

## 작성일
2025-09-03

---
## 1. 개요
본 시스템은 이커머스 플랫폼으로, 사용자에게 상품 탐색, 주문, 결제, 배송 추적 및 고객 지원 서비스를 제공하고, 관리자에게는 상품/재고/회원 관리와 알림/게시판 관리 기능을 제공합니다.  
향후 마이크로서비스 아키텍처(MSA)와 머신러닝 기반 추천 시스템을 도입할 수 있도록 확장성을 고려합니다.  
또한 개인정보 보호, 이력 관리, 외부 연동 안정성을 강화합니다.

**기술 스택**: Java, Spring Boot, Spring Security + JWT, Thymeleaf, PostgreSQL

---

## 2. 기능 요구사항

### 2.1 메인 화면
- 로그인
- 인기 상품 TOP 10 / 베스트 / 할인 상품 등 이벤트 표출 (우선 DB로 개발 후 추후 레디스로 변경)
  - 인기상품(기준 : 판매량)
  - 베스트(기준 : 리뷰 수)
- 상품 광고 배너
  - 광고 배너는 외주사의 지급 비용에 따라서 우선순위(score)에 따른 차등 표출 기능 필요(심화 선택)
  - 광고는 5개까지
  - 카드 배너
- 상품 카테고리 선택 메뉴(카테고리 갯수는 알아서...)

### 2.2 상품 카탈로그
- 상품 검색/필터링/정렬
  - 키워드 검색(Elasticsearch를 이용한 개발은 추후/인터페이스로 DB 검색으로 우선 개발할 것)
  - 브랜드/가격/평점/재고유무 필터
  - 가격 ↑↓, 인기순, 최신순 정렬
- 상품 상세 조회
  - 대표 이미지, 옵션(색상/사이즈), 상세 설명, 재고, 리뷰 요약
  - 메인 이미지 + 썸네일 
  - 옵션 선택 드롭 다운
  - 수량 선택 후 "장바구니 담기", "바로 구매" 버튼 
- 리뷰·평점
  - 구매 완료 후에만 작성 가능
  - 사진 첨부, 별점(1~5), 댓글

### 2.3 장바구니
- 아이템 목록, 수량 변경, 개별 삭제, 전체 선택 삭제
- 합계 금액, 예상 배송비, 쿠폰/포인트 적용란

### 2.4 주문
- 장바구니에 선택된 상품 재고 차감
- 장바구니에 선택된 상품 가격 Total

  - 주문 흐름
    - 장바구니 → “주문하기” 클릭
    - 주소 선택/등록 → 배송비 계산
    - 결제 수단 선택(신용카드·가상계좌·페이 등)
    - 환불/취소
    - 주문 상태별 취소 가능성 제어(A: 결제 전, B: 배송 전)
    - 환불 처리 → 재고 복구

### 2.5 결제
- 외부 결제 시스템 연동(별도 외부 서버 하나 개발해서 제공 예정)
- 유저가 가진(혹은 충전한) 금액 차감(포인트/쿠폰이 있다면 고려해서 같이 차감)

### 2.6 배송 추적
- 기능 설명
  - 외부 배송사 API 연동(운송장 조회)(별도 외부 서버 하나 개발해서 제공 예정)
  - 주문 상태(결제완료 → 배송준비 → 배송중 → 배송완료) 표시
  - 마이페이지 → 주문 상세 → 배송 현황 타임라인

### 2.7 고객센터
- 게시판 기능
  - 페이지네이션
  - 제목, 내용, 이미지 첨부
  - 간단한 댓글 기능
  - 좋아요 기능(선택 사항)
- 문의받고 처리 완료 메일(매크로) 전송 기능 --> "유저 이메일로 전송"
- 공지사항 표출

### 2.8 회원 관리
- 회원 정보 수정
- 비밀번호 변경 
- 마이페이지 
  - 주문 상세(데이터셋은 본인 입맛대로 만드세요)

### 2.9 관리자
- 알림(이메일/SMS/푸시)
  - 문의 완료 메일 관리 등
  - 알림 기능 완료되면 해당 기능은 되었다고 가정(인터페이스만 개발 하라/기능은 동작하게 -- 디스코드를 예시로 개발해주세요)
- 게시글·댓글 블라인드, 신고 관리 기능(선택 사항)
- 카드 배너 적용 기능
- 공지사항 작성/삭제 기능
- 재고 관리 기능(추가 기획 필요하므로 추후 재 공지 예정)

### 2.10 비기능적요구사항
- 로그인 권한(유저, 어드민)
  - 어드민은 관리자 툴 접근이 가능
- 성능: 상품 조회 200ms 이내, 주문 처리 1초 이내
- 안정성: 재고 동시성 100TPS 이상 버티기
- 보안: TLS 1.2+, OWASP Top10 방어(선택), JWT 만료·리프레시
- 확장성: 마이크로서비스 이관 준비(Outbox Pattern 적용)
- 개인화 추천: ML 기반 상품 추천 엔진
---

## 3. 도메인 모델 정의 및 정책

### 3.1 회원 도메인

| 기능 | 정책 |
|------|------|
| 회원가입 | 이메일 고유, 비밀번호 암호화(BCrypt), 휴대폰 인증 여부 저장, 기본 권한 `ROLE_USER` |
| 로그인/인증 | 로그인 실패 5회 시 30분 잠금, JWT Access/Refresh Token 관리, 기기별 세션 분리, Refresh Token DB/Redis 저장 |
| 회원 정보 관리 | 개인정보 변경 시 본인 인증 필요, 탈퇴 시 `deleted_at` 논리 삭제, 관리자 비활성화만 가능 |
| 권한 관리 | 사용자/관리자 역할 제공, 관리자 MFA 필수, Spring Security `@PreAuthorize` 기반 접근 제어 |
| 마이페이지 | 본인 계정만 접근, 주문/배송/포인트/쿠폰 본인 데이터만 조회 가능 |

**데이터**
- 회원: `user_id`, `email`, `password`, `name`, `phone`, `role_id`, `created_at`, `updated_at`, `deleted_at`
- 권한: `role_id`, `role_name`, `created_at`, `updated_at`
- 인증: `auth_token`, `refresh_token`, `expires_at`, `created_at`, `updated_at`
- 주소: `address_id`, `user_id`, `recipient_name`, `recipient_phone`, `zipcode`, `detail_address`, `is_default`, `created_at`, `updated_at`

---

### 3.2 상품 도메인

| 기능 | 정책 |
|------|------|
| 상품 검색/필터링/정렬 | DB 검색 우선, 키워드 검색, 필터(브랜드, 가격, 평점, 재고), 정렬(가격, 인기순, 최신순), SQL 인젝션 방지 |
| 상품 상세 조회 | 대표 이미지 1개 + 썸네일, 옵션 드롭다운, 상세 설명, 가격, 재고, 리뷰 요약, 품절/판매중지 구매 제한 |
| 옵션/재고 관리 | 옵션별 가격/재고 관리, 주문 시 재고 차감, 결제 실패 시 재고 복구, 재고 0 시 구매 제한, 관리자 로그 기록 |
| 가격/프로모션 | 할인/쿠폰 적용가 별도 표시, 기간 기반 프로모션 가능, 종료 시 자동 원복 |
| 데이터 무결성 | 삭제 시 논리 삭제(`deleted_at`), 카테고리 삭제 시 하위 상품 비활성화, 이미지/옵션 `ON DELETE CASCADE` |
| 접근 권한 | 조회는 사용자, 등록/수정/삭제는 관리자(`ROLE_ADMIN`) |
| 성능/UX | 목록/카테고리/리뷰 캐싱 가능, 인기 상품 CDN 이미지 캐싱, 인기 검색어 Redis 저장 가능 |

**데이터**
- 상품: `product_id`, `name`, `description`, `brand`, `category_id`, `price`, `status`, `created_at`, `updated_at`
- 옵션: `option_id`, `product_id`, `attributes`, `additional_price`, `stock`, `created_at`, `updated_at`
- 이미지: `image_id`, `product_id`, `url`, `is_main`, `sort_order`, `created_at`, `updated_at`
- 카테고리: `category_id`, `name`, `parent_category`, `created_at`, `updated_at`

---

### 3.3 주문 도메인

| 기능 | 정책 |
|------|------|
| 장바구니 | 사용자별 독립, 옵션별 재고 확인, 수량 변경/삭제, 합계/배송비 계산, 쿠폰/포인트 적용, 30일 미사용 자동 비우기, 재고 부족 시 구매 제한 |
| 주문 생성 | 장바구니 → 주문하기 클릭, 주소 선택/등록 필수, 배송비 계산, 결제 수단 선택, 재고 차감, 가격 총합 계산, 실패 시 재고 원복 |
| 결제 처리 | 주문 상태별 취소 가능(A: 결제 전, B: 배송 전), 결제 성공 시 `PAID`, 실패 시 `PENDING`, PG사 응답 코드 저장, Idempotency Key 적용 |
| 환불/취소 | 상태별 취소 가능, 환불 시 재고 복구, 사유 기록, 카드 환불 3~5일, 가상계좌/페이 정책 준수, 관리자 승인 시 Workflow |
| 배송 관리 | 외부 배송사 API 연동(운송장 조회), 주문 상태 단계별 관리, 배송 타임라인 제공, 오류 시 재시도/관리자 알림 |
| 재고/무결성 | 주문 시 재고 차감, 취소/환불 시 재고 복구, 관리자 로그 필수 |
| 접근 권한 | 생성/조회는 사용자, 수정/취소는 주문자, 관리자 API는 상태 변경/취소 승인 전용 |
| 성능/UX | 조회 캐싱 가능, 대량 주문 배치 처리, 배송비 계산 최적화, 할인/포인트 즉시 반영 |
| 예외 처리 | 재고 부족, 결제 실패, 배송 불가 지역 처리, 중복 주문 방지(Idempotency Key) |

**데이터**
- 장바구니: `cart_id`, `user_id`, `product_id`, `option_id`, `quantity`, `price`, `created_at`, `updated_at`
- 주문: `order_id`, `user_id`, `recipient_name`, `recipient_phone`, `zipcode`, `detail_address`, `payment_method`, `total_amount`, `status`, `created_at`, `updated_at`
- 주문 상세: `order_item_id`, `order_id`, `product_id`, `option_id`, `option_snapshot`, `quantity`, `unit_price`, `created_at`, `updated_at`
- 환불 내역: `refund_id`, `order_id`, `amount`, `status`, `reason`, `processed_at`, `created_at`, `updated_at`
- 배송: `shipment_id`, `order_id`, `carrier`, `tracking_number`, `status`, `created_at`, `updated_at`

---

### 3.4 결제 도메인

| 기능 | 정책 |
|------|------|
| 외부 결제 연동 | 별도 서버 연동 예정, 결제 승인/거절 응답 처리, 실패 시 DB 롤백, Mock 서버 우선 |
| 결제 처리 | 최종 금액 = 상품 총액 + 배송비 - 포인트 - 쿠폰, 결제 성공 시 `PAID`, 실패 시 `PENDING`, Idempotency Key 적용 |
| 포인트 | 사용 범위 내 사용, 거래 내역 기록, 충전 승인 후 반영, 환불 시 복구 |
| 쿠폰 | 최소 주문 금액/유효기간 검증, 사용 시 `USED`, 환불 시 복구 |
| 환불 처리 | 외부 서버 연동, 처리 시간 준수, 환불 완료 시 `REFUNDED`, 재고 복구 |
| 접근 권한 | 로그인 사용자만 결제 가능, 관리자 결제 확인 가능 |
| 보안 | TLS/HTTPS 필수, 민감 정보 DB 저장 최소화, 암호화 처리 |

**데이터**
- 결제: `payment_id`, `order_id`, `payment_method`, `amount`, `status`, `transaction_id`, `created_at`, `updated_at`
- 포인트: `point_id`, `user_id`, `order_id`, `amount`, `status`, `created_at`, `updated_at`
- 쿠폰: `coupon_id`, `code`, `discount_amount`, `min_order_amount`, `status`, `valid_from`, `valid_to`, `created_at`, `updated_at`

---

### 3.5 리뷰 도메인
| 기능 | 정책 |
|------|------|
| 리뷰 작성 | 주문 완료된 상품에 대해 작성 가능, 평점 1~5 필수, 내용 작성 필수, 이미지 첨부 최대 5장, 상태 관리(작성/수정/삭제) |
| 리뷰 수정 | 작성자 본인만 수정 가능, 수정 시 `updated_at` 갱신 |
| 리뷰 삭제 | 작성자 본인/관리자 가능, 논리 삭제(`deleted_at`) 적용, 로그 기록 필수 |
| 리뷰 요약 | `review_summary` 테이블에 상품별 평균 평점(`avg_rating`)과 리뷰 수(`review_count`) 자동 반영 |
| 댓글 작성 | 리뷰에 댓글 작성 가능, 계층 구조 지원(`parent_comment_id`), 내용 필수 |
| 댓글 수정/삭제 | 작성자 본인/관리자 가능, 논리 삭제(`deleted_at`) 적용, 로그 기록 필수 |
| 접근 권한 | 작성자 본인 조회/수정 가능, 관리자 전체 조회/관리 가능 |
| 알림 | 댓글/리뷰 작성 시 작성자/관리자에게 알림(Mock 가능) |

**데이터**
- 리뷰: `review_id`, `order_item_id`, `user_id`, `product_id`, `rating`, `content`, `image_url`, `created_at`, `updated_at`, `deleted_at`
- 리뷰 요약: `product_id`, `avg_rating`, `review_count`, `created_at`, `updated_at`
- 리뷰 댓글: `comment_id`, `review_id`, `user_id`, `content`, `parent_comment_id`, `created_at`, `updated_at`, `deleted_at`

### 3.6 고객센터 도메인

| 기능 | 정책 |
|------|------|
| 문의 | 제목/내용/카테고리 필수, 첨부 이미지 최대 5장, 상태 관리(대기/처리중/완료) |
| 답변 | 담당자 배정, 답변 작성 시 알림 이메일 발송(Mock 가능) |
| 공지사항 | 관리자 전용 작성/수정/삭제, 게시기간 지정 가능 |
| 접근 권한 | 작성자 본인 조회/수정 가능, 관리자 전체 조회/관리 가능 |
| 데이터 보존 | 삭제 시 논리 삭제(`deleted_at`), 로그 기록 필수 |

**데이터**
- 문의: `inquiry_id`, `user_id`, `title`, `content`, `category`, `status`, `assigned_admin_id`, `created_at`, `updated_at`, `deleted_at`
- 답변: `reply_id`, `inquiry_id`, `admin_id`, `content`, `created_at`, `updated_at`
- 공지사항: `notice_id`, `title`, `content`, `start_date`, `end_date`, `created_at`, `updated_at`

---

### 3.7 관리자 도메인

| 기능 | 정책 |
|------|------|
| 사용자/권한 관리 | 회원 조회/활성화/탈퇴, 권한 부여/변경, MFA 필수 |
| 상품/재고 관리 | 상품 등록/수정/삭제, 옵션/재고 관리, 재고 로그 기록 |
| 주문/결제 관리 | 주문 상태 변경, 환불 승인, 결제 내역 조회 |
| 고객센터 관리 | 문의글 답변, 블라인드 처리, 공지사항 작성 |
| 배너/공지 | 배너 등록/수정/삭제, 게시기간 지정 |
| 로그/감사 | 모든 변경/삭제 행위 기록, 접근 권한별 조회 제한 |
| 접근 권한 | `ROLE_ADMIN` 전용, MFA 필수 |
| 알림 | 이메일/SMS/푸시(Mock 서버)로 사용자 알림, 실패 시 재시도 |

**데이터**
- 로그: `log_id`, `admin_id`, `action`, `target_type`, `target_id`, `description`, `created_at`
- 배너: `banner_id`, `title`, `image_url`, `start_date`, `end_date`, `status`, `created_at`, `updated_at`

---

## 4. 정책표
- 재고 차감: 주문 시 즉시, 결제 실패/취소 시 복구
- 결제 중복 방지: Idempotency Key
- 회원 탈퇴: `deleted_at` 논리 삭제 + 개인정보 익명화
- 장바구니 자동 삭제: 30일 미사용
- 이메일 알림: Mock 서버, 실패 시 관리자 로그 기록
- 주문 상태: `CREATED → PAID → SHIPPING → DELIVERED → COMPLETED`
- 환불 정책: 카드 3~5일, 가상계좌/페이 PG 정책 준수
- 관리자 MFA: 필수, 변경/삭제/권한 부여 시 적용

---
## 5. 기타 고려사항
- 초기에는 DB 기반으로 개발하되, 검색 및 캐싱은 Elasticsearch/Redis로 점진적 확장
- 외부 연동(결제, 배송사) 기능은 인터페이스 우선 개발 후 실제 API 연동으로 확장
- 재고 동시성 이슈 해결을 위한 Locking 전략 필요
- 모든 주요 엔터티에 변경 이력/감사 로그 기록

---
### 작성자
- 김동욱

